<!DOCTYPE html>
<!--[if IE 8]> 				 <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->

<head>
	<meta charset="utf-8" />
  <meta name="viewport" content="width=device-width" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <title>Undian Koperasi</title>

  <link rel="stylesheet" href="css/normalize.css" />
  <link rel="stylesheet" href="css/foundation.css" />
  <link rel="stylesheet" href="css/cards.css">
  <script src="js/vendor/custom.modernizr.js"></script>
  <script src="js/jquery-latest.min.js"></script>
  <script src="js/anggota.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tsparticles/confetti@3.0.3/tsparticles.confetti.bundle.min.js"></script>

<style>
#values { position:relative;font-size:400%;text-align:center;margin: 0 auto;z-index:0; }
.name { overflow:hidden;display:block; }
#names { display:none;padding:5px; }
#namesbox { min-height: 400px;
  font-size: 20px;
  color: #333;
  resize: none;
  border: 1px solid #F39C12;
  background: bottom;
  border-radius: 10px; }
.extra { font-size:16px;margin-top:20px; }
#winnerbox { min-height:600px;font-size:32px;color:#333;resize:none;border:1px solid #F39C12; }
#result1 { background:#000;color:#fbe34b;padding:20px;z-index:10;margin-top:-150px; }
body {
  background: #FCFAEE;
}
#varnote { font-size:40px;text-align:center;padding:30px; }
.copyright { font-size:11px;font-family:Tahoma;color:#9B59B6; }
table {
  font-family: arial, sans-serif;
  border-collapse: collapse;
  width: 100%;
}

td, th {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 8px;
}

tr:nth-child(even) {
  background-color: #dddddd;
}
</style>

</head>
<body onload="reset();">

  <div class="full-head" style="width:100%;background:#111 url(img/header-bg.png) repeat-x center top;border-bottom:1px solid #D35400;">
	<center>
    <div class="row">
      <div class="large-12 columns" style="padding-top:50px;background:#111 url(img/header-bg.png) repeat-x center top;z-index:20;">
        <ul class="button-group even-2">
          <!--<li><a href="index.html" class="alert button" id="reset">Reset</a></li>-->
          <li><button class="button" id="list" onclick="namelist();">Daftar Nama</button></li>
          <!--<li><button class="button" id="save" onclick="save();">Save &amp; Update</button></li>-->
          <!-- <li><button class="button" id="price" onclick="hadiahlist();">Daftar Hadiah</button></li> -->
          <!-- <li><button class="success button" id="go" onclick="go();">Mulai!</button></li> -->
          <li><button class="button" id="pemenang" onclick="pemenang();">Undian</button></li>
        </ul>
      </div>
	  </div>
  </center>
	</div>

	<div class="row" style="max-width: 100%;">
		<div class="large-12 columns">
			<h3 style="text-align:center;margin-top:30px;" id="headline">Let's see who is The Lucky One?</h3>
      <!-- <button class="small success button" type="button" id="print" style="display: none; margin-bottom: 6px;" onclick="doPrint()"><i class="fa fa-file"></i> Cetak</button> -->
			
			<div id="varnote"><img src="img/logorapat.png"><div class="copyright">&copy; Coded by <strong>Heiswayi Nrird</strong>, June 2013</div></div>
			
      <div id="popdown">
        <div id="names" class="inbox"><textarea name="namesbox" id="namesbox"></textarea></div>


          <!-- <div id="winner" class="inbox"><textarea name="winnerbox" id="winnerbox"></textarea></div> -->
          <div id="winner" class="inbox">
            <div class="contenedorCards">
              <div class="card">
                <div class="wrapper">
                  <div class="colorProd"></div>
                  <div class="imgProd" style="background-image: url('img/Hadiah/honda_beat_hitam.png')"></div>
                  <div class="infoProd">
                    <p class="nombreProd">SEPEDA MOTOR HONDA BEAT</p>
                    <p class="extraInfo">????</p>
                    <div class="actions">
                      <div class="bakuretsu_icono action aFavs" onclick="acak(0)">
                        <i class="fa fa-play"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- kulkas -->
              <div class="card"> 
                <div class="wrapper">
                  <div class="colorProd" style="background-color: #1d1d1d;"></div>
                  <div class="imgProd" style="background-image: url('img/Hadiah/kulkas.png');"></div>
                  <div class="infoProd">
                    <p class="nombreProd">Kulkas</p>
                    <p class="extraInfo">????</p>
                    <div class="actions">
                      <div class="bakuretsu_icono action aFavs" onclick="acak(1)">
                        <i class="fa fa-play"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- TV 24" -->
              <div class="card">
                <div class="wrapper">
                  <div class="colorProd" style="background-color: #456f1b;"></div>
                  <div class="imgProd" style="background-image: url('img/Hadiah/tv_led.png');"></div>
                  <div class="infoProd">
                    <p class="nombreProd">TV 24"</p>
                    <p class="extraInfo">????</p>
                    <div class="actions">
                      <div class="bakuretsu_icono action aFavs" onclick="acak(2)">
                        <i class="fa fa-play"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card">
                <div class="wrapper">
                  <div class="colorProd" style="background-color: #153a82;"></div>
                  <div class="imgProd" style="background-image: url('img/Hadiah/mtb.png');"></div>
                  <div class="infoProd">
                    <p class="nombreProd">SEPEDA 1</p>
                    <p class="extraInfo">????</p>
                    <div class="actions">
                      <div class="bakuretsu_icono action aFavs" onclick="acak(3)">
                        <i class="fa fa-play"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card">
                <div class="wrapper">
                  <div class="colorProd" style="background-color: #3f4a69;"></div>
                  <div class="imgProd" style="background-image: url('img/Hadiah/mesin_cuci.webp');"></div>
                  <div class="infoProd">
                    <p class="nombreProd">MESIN CUCI</p>
                    <p class="extraInfo">????</p>
                    <div class="actions">
                      <div class="bakuretsu_icono action aFavs" onclick="acak(4)">
                        <i class="fa fa-play"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card">
                <div class="wrapper">
                  <div class="colorProd" style="background-color: #1b6f44;"></div>
                  <div class="imgProd" style="background-image: url('img/Hadiah/kompor_gas_2.png');"></div>
                  <div class="infoProd">
                    <p class="nombreProd">KOMPOR GAS</p>
                    <p class="extraInfo">????</p>
                    <div class="actions">
                      <div class="bakuretsu_icono action aFavs" onclick="acak(5)">
                        <i class="fa fa-play"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card">
                <div class="wrapper">
                  <div class="colorProd" style="background-color: #1b6f44;"></div>
                  <div class="imgProd" style="background-image: url('img/Hadiah/kompor_gas_2.png');"></div>
                  <div class="infoProd">
                    <p class="nombreProd">KOMPOR GAS (BANK BANTUL)</p>
                    <p class="extraInfo">????</p>
                    <div class="actions">
                      <div class="bakuretsu_icono action aFavs" onclick="acak(6)">
                        <i class="fa fa-play"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card">
                <div class="wrapper">
                  <div class="colorProd" style="background-color: #6247aa;"></div>
                  <div class="imgProd" style="background-image: url('img/Hadiah/magic_com.png');"></div>
                  <div class="infoProd">
                    <p class="nombreProd">MAGIC COM</p>
                    <p class="extraInfo">????</p>
                    <div class="actions">
                      <div class="bakuretsu_icono action aFavs" onclick="acak(7)">
                        <i class="fa fa-play"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card">
                <div class="wrapper">
                  <div class="colorProd" style="background-color: #6247aa;"></div>
                  <div class="imgProd" style="background-image: url('img/Hadiah/magic_com.png');"></div>
                  <div class="infoProd">
                    <p class="nombreProd">MAGIC COM (BANK BANTUL)</p>
                    <p class="extraInfo">????</p>
                    <div class="actions">
                      <div class="bakuretsu_icono action aFavs" onclick="acak(8)">
                        <i class="fa fa-play"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card">
                <div class="wrapper">
                  <div class="colorProd" style="background-color: #5369bf;"></div>
                  <div class="imgProd" style="background-image: url('img/Hadiah/kipas.png');"></div>
                  <div class="infoProd">
                    <p class="nombreProd">KIPAS ANGIN</p>
                    <p class="extraInfo">????</p>
                    <div class="actions">
                      <div class="bakuretsu_icono action aFavs" onclick="acak(9)">
                        <i class="fa fa-play"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card">
                <div class="wrapper">
                  <div class="colorProd" style="background-color: #5369bf;"></div>
                  <div class="imgProd" style="background-image: url('img/Hadiah/kipas.png');"></div>
                  <div class="infoProd">
                    <p class="nombreProd">KIPAS ANGIN (BANK BANTUL)</p>
                    <p class="extraInfo">????</p>
                    <div class="actions">
                      <div class="bakuretsu_icono action aFavs" onclick="acak(10)">
                        <i class="fa fa-play"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card">
                <div class="wrapper">
                  <div class="colorProd" style="background-color: #5369bf;"></div>
                  <div class="imgProd" style="background-image: url('img/Hadiah/dispenser.png');"></div>
                  <div class="infoProd">
                    <p class="nombreProd">DISPENSER</p>
                    <p class="extraInfo">????</p>
                    <div class="actions">
                      <div class="bakuretsu_icono action aFavs" onclick="acak(11)">
                        <i class="fa fa-play"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card">
                <div class="wrapper">
                  <div class="colorProd" style="background-color: #5369bf;"></div>
                  <div class="imgProd" style="background-image: url('img/Hadiah/speaker_aktif.png');"></div>
                  <div class="infoProd">
                    <p class="nombreProd">SPEAKER AKTIF (BANK BANTUL)</p>
                    <p class="extraInfo">????</p>
                    <div class="actions">
                      <div class="bakuretsu_icono action aFavs" onclick="acak(12)">
                        <i class="fa fa-play"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card">
                <div class="wrapper">
                  <div class="colorProd" style="background-color: #5369bf;"></div>
                  <div class="imgProd" style="background-image: url('img/Hadiah/setrika.png');"></div>
                  <div class="infoProd">
                    <p class="nombreProd">SETRIKA (BANK BANTUL)</p>
                    <p class="extraInfo">????</p>
                    <div class="actions">
                      <div class="bakuretsu_icono action aFavs" onclick="acak(13)">
                        <i class="fa fa-play"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>

          <center style="padding-bottom:30px">
            <select name="prizes" id="prizes" onchange="showCategory();" onfocus="this.selectedIndex = 0;" style="width: 600px; padding: 8px;">
              <option value="" selected>Pilih Undian</option>
              <option value="utama">~ Undian Utama ~</option>
              <option value="doorprize">~ Doorprize ~</option>
            </select>
          </center>

          <!-- <center style="margin-top:10px"><button class="success button" style="width:600px" id="go" onclick="go();">Mulai!</button></center> -->

      </div> <!--popdown-->

      
      <div id="values"></div>


		</div>
	</div>

  <script>
  document.write('<script src=' +
  ('__proto__' in {} ? 'js/vendor/zepto' : 'js/vendor/jquery') +
  '.js><\/script>')
  </script>
  
  <script src="js/foundation.min.js"></script>
  <script>$(document).foundation();</script>
  
<script>
var text;
var names = getDoorprizeMembers();

var winnerList = new Array();
var clickedPrize = -1;

function reset(){
  // re-enable go button
  // setTimeout("$('#go').removeAttr('disabled')",11005);
  var namesbreak = "";
  if(gup('names') != ""){
    var names = gup('names');
    namesbreak = names.replace(/101/g,'\n');
    namesbreak = namesbreak.replace(/%20/g,' ');          
    }
    else   {
      var names = getDoorprizeMembers();
    for(var i in names){
      name = names[i];
      if (name == "" || typeof(name) == undefined){}else{
         namesbreak = namesbreak + name + "\n";
      }
    }
  }
  $("#namesbox").val(namesbreak);
}

function setMembersToAll(){
  var namesbreak = "";
  if(gup('names') != ""){
    var names = gup('names');
    namesbreak = names.replace(/101/g,'\n');
    namesbreak = namesbreak.replace(/%20/g,' ');          
    }
    else   {
      var names = getAllMembers();
    for(var i in names){
      name = names[i];
      if (name == "" || typeof(name) == undefined){}else{
         namesbreak = namesbreak + name + "\n";
      }
    }
  }
  $("#namesbox").val(namesbreak);
}

function showCategory(){

  var categorySelected = $('#prizes').val();

  const prizes = document.querySelectorAll(".card");
  if(categorySelected == "utama"){
    setMembersToAll();
    for(var i = 0; i < prizes.length; i++){
      if(i < 5){
        prizes[i].style.display = "block";
      }else{
        prizes[i].style.display = "none";
      }
    }
  }else if(categorySelected == "doorprize"){
    reset();
    for(var i = 0; i < prizes.length; i++){
      if(i >= 5){
        prizes[i].style.display = "block";
      }else{
        prizes[i].style.display = "none";
      }
    }
  }else{
    for(var i = 0; i < prizes.length; i++){
      prizes[i].style.display = "block";
    }
  }
}

function gup(para)
{
  para = para.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  var regexS = "[\\?&]"+para+"=([^&#]*)";
  var regex = new RegExp( regexS );
  var results = regex.exec( window.location.href );
  if( results == null )
    return "";
  else
    return results[1];
}

function randOrd(){
	return (Math.round(Math.random())-0.5); 
}

function save(){
        $("#varnote").hide();
        $("#popdown").show();
        $("#values").hide();
        $("div").remove("#result1");
        savenames = $("#namesbox").val();
        savenames = savenames.replace(/\n\r?/g, '101');
        $('#headline').fadeOut();
        $('#headline').text('The name list is saved and updated.').fadeIn();
        $("#names").show();
        $('#namesbox').attr('disabled','disabled');

        // $("#print").hide();
}

function namelist(){
        $("#varnote").hide();
        $('#namesbox').removeAttr('disabled','disabled');
        $('#headline').text('Daftar Anggota');
        $("#popdown").show();
        $("#values").hide();
        $("#names").show();
        // $("#prizes").hide();
        $("#winner").hide();
        $('body').css({"overflow-y": "visible"});
        // $('#go').hide();
        // $("#print").hide();
}
function hadiahlist(){
        $("#varnote").hide();
        $('#namesbox').removeAttr('disabled','disabled');
        $('#headline').text('Pilih Hadiah');
        $("#popdown").show();
        $("#values").hide();
        // $("#prizes").show();
        $("#names").hide();
        $("#winner").hide();
        $('body').css({"overflow-y": "visible"});
        // $('#go').show();

        // $("#print").hide();
}
function pemenang(){
        $("#varnote").hide();
        $('#namesbox').removeAttr('disabled','disabled');
        $('#headline').text('Undian RAT Koperasi');
        $("#popdown").show();
        $("#values").hide();
        // $("#prizes").show();
        $("#names").hide();
        $("#winner").show();
        $('body').css({"overflow-y": "visible"});
        // $('#go').show();
        // $("#print").show();
}

function doPrint(){
  w=window.open();
  w.document.write($("#winner").html());
  w.print();
  w.close();
}

// does the actual animation
function go(){
  if($("#prizes").val() == ""){
    return;
  }
  $("#varnote").hide();
  $('body').css({"overflow-y": "hidden"});
  // $('#go').attr('disabled','disabled');
  $('#list').attr('disabled','disabled');
  $('#save').attr('disabled','disabled');
  $('#headline').slideUp();
  $('#namesbox').slideDown();

  // $("#print").hide();

  var count = 1;
  count = 1;
  $("div").remove("#result1");
  names = $("#namesbox").val();
  if(document.all) { // IE
    names=names.split("\n");
  }
  else { //Mozilla
    names=names.split("\n");
  }
  $("#values").show();
  $(".name").show();
  $("#popdown").hide();
  $("div").remove(".name");
  $("div").remove(".extra");
  $("#playback").html("");
  newtop = names.length * 200 * -1;
  //$('#values').css({top: -300});
  $('#values').css({top: + newtop});	
  names.sort( randOrd );
  var fruits = new Array ( "apple", "pear", "orange", "banana" );
  //console.log(fruits);
  //console.log(names);
  //alert(newtop);
  for(var i in names){
    if (names[i] == "" || typeof(names[i]) == undefined){
      count = count-1;
    } else {
      name = names[i];
      //console.log(name);
      $('#values').append('<div id=result'+count+' class=name>'+name+'</div>');
    }
    count = count+1;
  }
  for(var i in names){
    if (names[i] == "" || typeof(names[i]) == undefined){}else{
      name = names[i];
      $('#values').append('<div class=name>'+name+'</div>');
    }
    count = count+1;
  }
  for(var i in names){
    if (names[i] == "" || typeof(names[i]) == undefined){}else{
      name = names[i];
      $('#values').append('<div class=name>'+name+'</div>');
    }
    count = count+1;
  }
  text = $('#result1').text()
  $('#values').animate({top: '+176'},5000);

  // make it stand out
  setTimeout("standout(text)",5000);
  //setTimeout("$('#playback').hide('slow')",11005);
}

// does the actual animation
function acak(index){

  var categorySelected = $('#prizes').val();
  console.log(categorySelected);
  if(categorySelected == ""){
    alert("Silahkan Pilih Kategori Undian.");
    return;
  }

  window.scrollTo(0, 0);
  clickedPrize = index;
  $("#varnote").hide();
  $('body').css({"overflow-y": "hidden"});
  // $('#go').attr('disabled','disabled');
  $('#list').attr('disabled','disabled');
  $('#save').attr('disabled','disabled');
  $('#headline').slideUp();
  $('#namesbox').slideDown();

  var count = 1;
  count = 1;
  $("div").remove("#result1");
  names = $("#namesbox").val();
  if(document.all) { // IE
    names=names.split("\n");
  }
  else { //Mozilla
    names=names.split("\n");
  }
  $("#values").show();
  $(".name").show();
  $("#popdown").hide();
  $("div").remove(".name");
  $("div").remove(".extra");
  $("#playback").html("");
  newtop = names.length * 200 * -1;
  $('#values').css({top: + newtop});	
  names.sort( randOrd );
  var fruits = new Array ( "apple", "pear", "orange", "banana" );
  for(var i in names){
    if (names[i] == "" || typeof(names[i]) == undefined){
      count = count-1;
    } else {
      name = names[i];
      $('#values').append('<div id=result'+count+' class=name>'+name+'</div>');
    }
    count = count+1;
  }
  for(var i in names){
    if (names[i] == "" || typeof(names[i]) == undefined){}else{
      name = names[i];
      $('#values').append('<div class=name>'+name+'</div>');
    }
    count = count+1;
  }
  for(var i in names){
    if (names[i] == "" || typeof(names[i]) == undefined){}else{
      name = names[i];
      $('#values').append('<div class=name>'+name+'</div>');
    }
    count = count+1;
  }
  text = $('#result1').text()
  $('#values').animate({top: '+176'},5000);

  // make it stand out
  setTimeout("standout(text)",5000);
  //setTimeout("$('#playback').hide('slow')",11005);
}

function standout(text){


        $('#result1').removeClass('name');
        $('.name').animate({opacity: .25});
        $('#result1').animate({height: '+=130px'});
        $('#result1').append('<div class="extra"><a class="alert button" href="#" onClick="removevictim();">Simpan</a></div>');
        // $('#go').removeAttr('disabled','disabled');
        $('#list').removeAttr('disabled','disabled');
        $('#save').removeAttr('disabled','disabled');
        $('#headline').text('Pemenang Hadiah ' + document.querySelectorAll(".card")[clickedPrize].getElementsByClassName("nombreProd")[0].innerText);
        $('#headline').slideDown();

        addToWinnerList();

        // $('#prizes').val("");
}

function removevictim(){
	// Removing victim from array and UI
	// names = names.filter(function(){ return true});
	// Rewriting namesbox contents
	var nameupdated = "";
	for(var i in names){
		name = names[i];
                if (name == "" || name == text || typeof(name) == undefined){}else{
			nameupdated = nameupdated + "\n" + name;
		}
	}
	$('#namesbox').val("");
  $('#namesbox').val(nameupdated);
  $('#result1').html("Removed");
  $('#result1').fadeOut(1000, function(){
    $("div").remove("#result1");
  });
  $("div").remove(".name");
  $("div").remove(".extra");
  $('#headline').text('OK, done! Let\'s see who is next? Just click "GO!" button for next roll.');

  //addToWinnerList();
  pemenang();
}

function addToWinnerList(){
  var existedElementIndex = -1;

  var iterExisted = -1;
  winnerList.forEach(element => {
    iterExisted++;
    if(element.prizeIndex == clickedPrize){
      existedElementIndex = iterExisted;
    }
  });

  if(existedElementIndex >= 0){ // jika sudah exists
    winnerList[existedElementIndex].name = text;
  }else{
    winnerList.unshift({
      'name' : text,
      'prizeIndex' : clickedPrize
    });
  }

  renderPrizeAndWinner();
  duration = 15;
  if(clickedPrize > 0){
    duration = 1;
  }
  const end = Date.now() + duration * 1000;

  // go Buckeyes!
  const colors = ["#bb0000", "#ffffff"];

  (function frame() {
    confetti({
      particleCount: 4,
      angle: 60,
      spread: 55,
      origin: { x: 0 },
      colors: colors,
    });

    confetti({
      particleCount: 4,
      angle: 120,
      spread: 55,
      origin: { x: 1 },
      colors: colors,
    });

    if (Date.now() < end) {
      requestAnimationFrame(frame);
    }
  })();
}

function renderPrizeAndWinner(){
  console.log(winnerList);
  winnerList.forEach(element => {
    const prizes = document.querySelectorAll(".card");
    console.log(prizes[element.prizeIndex].getElementsByClassName("extraInfo"));
    prizes[element.prizeIndex].getElementsByClassName("extraInfo")[0].innerText = element.name;
  });
}

</script>



</body>
</html>
